<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>4x4 Grid Puzzle</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      background: #f0f0f0;
    }
    .grid {
      position: relative;
      margin: 0 auto;
    }
    .piece {
      /* background-color: #d8b1b100; */
      position: absolute;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 1.5rem;
      cursor: pointer;
      transition: transform 0.2s;
    }
    .piece:hover {
      transform: scale(1.1);
    }
  </style>
</head>
<body>
  <div class="grid" id="grid"></div>
  <script>
    // Configuration
    const cols = 4;
    const rows = 4;
    const cellSize = 220;   // size of each piece in pixels
    const overlap = 85;     // overlap amount in pixels
    const gridSize = cols * cellSize - (cols - 1) * overlap;

    // Helper to load and parse an SVG file inline
    async function loadSVG(path) {
      const resp = await fetch(path);
      const text = await resp.text();
      const parser = new DOMParser();
      return parser.parseFromString(text, 'image/svg+xml').documentElement;
    }

    // Array of SVG file paths
    const svgShapes = [
      'shapes/1.svg', 
    ];

    // Corresponding fill colors for each shape
    const shapeColors = [
      '#F9F572', // yellow
      '#3C449F', // blue
      '#EA6162'  // red
    ];

    (async () => {
      const grid = document.getElementById('grid');
      // Apply dynamic grid size
      grid.style.width = `${gridSize}px`;
      grid.style.height = `${gridSize}px`;
      for (let i = 0; i < 16; i++) {
        const piece = document.createElement('div');
        piece.className = 'piece';
        piece.dataset.index = i;

        // Set piece dimensions
        piece.style.width = `${cellSize}px`;
        piece.style.height = `${cellSize}px`;

        // Position pieces so they overlap by 50px per row/col
        const col = i % 4;
        const row = Math.floor(i / 4);
        piece.style.left = `${col * (cellSize - overlap)}px`;
        piece.style.top  = `${row * (cellSize - overlap)}px`;

        // load inline SVG and set attributes
        const svg = await loadSVG(svgShapes[i % svgShapes.length]);
        svg.setAttribute('width', '99%');
        svg.setAttribute('height', '99%');

        // Rotate SVG: 90° per column plus an extra 90° per row
        const angle = (col + row) * 90;
        svg.style.transform = `rotate(${angle}deg)`;
        svg.style.transformOrigin = '50% 50%';

        // Try to extract the first <path> element
        const pathEl = svg.querySelector('path');
        if (pathEl && typeof pathEl.getTotalLength === 'function') {
          const totalLength = pathEl.getTotalLength();
          const numSamples = 100;
          const pts = [];
          for (let s = 0; s <= numSamples; s++) {
            const pt = pathEl.getPointAtLength((s/numSamples) * totalLength);
            pts.push(`${pt.x},${pt.y}`);
          }
          // Create a polygon from sampled points
          const poly = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
          poly.setAttribute('points', pts.join(' '));
          poly.setAttribute('fill', shapeColors[i % shapeColors.length]);
          poly.setAttribute('stroke', 'black');
          poly.setAttribute('stroke-width', '10');
          // Clear existing children and append the polygon
          while (svg.firstChild) svg.removeChild(svg.firstChild);
          svg.appendChild(poly);
        } else {
          // Fallback: color the SVG fill directly
          svg.setAttribute('fill', shapeColors[i % shapeColors.length]);
        }

        piece.appendChild(svg);

        piece.addEventListener('click', () => {
          console.log('Clicked piece', piece.dataset.index);
          alert('You clicked piece ' + (parseInt(piece.dataset.index) + 1));
        });
        grid.appendChild(piece);
      }
    })();
  </script>
</body>
</html>
